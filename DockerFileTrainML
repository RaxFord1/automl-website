# Use the official Ubuntu base image
FROM continuumio/miniconda3

WORKDIR /app

COPY . .

RUN conda env create -f environment_conda_train.yml

RUN echo "conda activate training-ml" > ~/.bashrc
SHELL ["/bin/bash", "--login", "-c"]

RUN conda activate training-ml && python -c "import google.protobuf; print(google.protobuf.__version__)"

RUN ./proto_init.sh

#RUN conda init && conda activate training-ml && cd /app && \
#    protoc --python_out=./ ./model_search/proto/phoenix_spec.proto && \
#    protoc --python_out=./ ./model_search/proto/hparam.proto && \
#    protoc --python_out=./ ./model_search/proto/distillation_spec.proto && \
#    protoc --python_out=./ ./model_search/proto/ensembling_spec.proto && \
#    protoc --python_out=./ ./model_search/proto/transfer_learning_spec.proto

#EXPOSE 5000

#CMD ["/bin/sh", "-c", "sleep infinity"]


#CMD ["conda", "run", "--no-capture-output", "-n", "training-ml", "python", "train.py"]
